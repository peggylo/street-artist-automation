# 街頭藝人申請 Shortcut - 技術文件

## 🎯 使用方式

### 從 LINE 觸發 Shortcut

當收到 LINE 訊息（來自申請機器人）：

1. **點擊 LINE 訊息中的連結**
   - 訊息會包含一個以 `shortcuts://` 開頭的連結
   
2. **iOS 會詢問：「在"捷徑"中打開？」**
   - 點選「打開」

3. **Shortcut 自動執行**
   - 整個過程約 15-20 秒
   - 不需要任何操作，等待即可

4. **聽到語音提示：「請老媽接手，打開書籤。」**
   - Safari 會自動開啟申請網站
   - 接下來使用 Safari 書籤繼續操作

---

## 🔊 執行過程

### 視覺效果
- Safari 會自動開啟並跳到申請網站首頁
- 無需手動操作

### 聽覺提示
- **VoiceOver 會報讀 Shortcut 的動作**（自動）
- **10 秒後會聽到語音：「請老媽接手，打開書籤。」**
- 這表示檔案已下載完成，可以開始使用書籤操作

### 下載的檔案
- **申請表 PDF**：檔名格式為「日期 申請表」（例如：`2026年1月28日 申請表`）
- **藝人證圖片**：檔名為「藝人證」
- **儲存位置**：iCloud Drive → 下載項目資料夾

---

## 🔍 Shortcut 流程說明（技術細節）

### 完整動作清單（共 13 個）

#### 第一階段：接收與解碼（動作 1-3）
1. **從 無位置 接收 文字**
   - 接收來自 LINE 的輸入（PDF 下載網址）
   - 若沒有輸入則繼續（允許空執行）

2. **URL 解碼**
   - 對捷徑輸入進行解碼
   - **關鍵步驟**：解決 LINE 傳來的 URL 編碼問題，避免檔名亂碼

3. **取得 URL 編碼文字 內容**
   - 下載 PDF 檔案內容

#### 第二階段：儲存申請表 PDF（動作 4-5）
4. **文字：「目前的日期 申請表」**
   - 動態生成檔名，格式：`yyyy年MM月dd日 申請表`
   - 解決 Google Drive 中文檔名亂碼問題

5. **將 URL 內容 儲存到 下載項目**
   - 將 PDF 檔案存到 iCloud Drive 的「下載項目」資料夾
   - 使用上一步生成的檔名

#### 第三階段：下載藝人證（動作 6-9）
6. **文字：（藝人證 Google Drive 下載網址）**
   - 固定網址，不從外部傳入

7. **取得 文字 內容**
   - 下載藝人證圖片內容

8. **文字：「藝人證」**
   - 固定檔名

9. **將 URL 內容 儲存到 下載項目**
   - 將藝人證圖片存到「下載項目」資料夾

#### 第四階段：開啟網站與語音提示（動作 10-13）
10. **打開 URL：（申請網站首頁網址）**
    - 自動在 Safari 開啟申請網站

11. **等待 10 秒**
    - 讓 VoiceOver 報讀完 Safari 的自動提示
    - 避免語音重疊

12. **朗讀文字：「請老媽接手，打開書籤。」**
    - 明確提示使用者接手操作
    - 指引下一步動作（使用 Safari 書籤）

13. **停止並輸出 朗讀文字**
    - 結束 Shortcut 執行

---

## 🔧 設計決策說明

### 為什麼需要 URL 解碼？
- **問題**：LINE 傳送 URL 時會自動編碼特殊字符
- **影響**：如果不解碼，Google Drive 回傳的中文檔名會變成亂碼
- **解決**：在接收輸入後立即進行 URL 解碼

### 為什麼使用「目前的日期」命名 PDF？
- **原始問題**：Google Drive 直接下載的中文檔名會顯示為 UTF-8 亂碼
- **舊方案困境**：無法可靠地從 URL 或檔案內容取得原始檔名
- **現行方案**：使用 Shortcut 執行當下的日期時間作為檔名
- **權衡**：犧牲「原始檔名的精確時間」，換取「清楚可讀的檔名」

### 為什麼等待 10 秒？
- **原因**：開啟 Safari 後，VoiceOver 會自動報讀網頁標題、載入狀態等資訊
- **目的**：等待這些自動報讀結束後，再播放「請老媽接手」的提示
- **效果**：避免語音重疊，讓使用者聽清楚每個提示

### 為什麼藝人證網址寫死在 Shortcut 中？
- **原因**：藝人證檔案固定不變，不需要每次傳入
- **好處**：
  - 簡化 LINE 訊息（只需傳一個 PDF URL）
  - 降低出錯機率（不會因為傳錯藝人證 URL 而失敗）
  - 維護容易（如需更換藝人證，只需更新 Shortcut）

### 為什麼只有一次語音提示？
- **原始設計**：每個步驟都有語音提示（PDF 下載完成、藝人證下載完成等）
- **實際問題**：多次提示反而造成干擾，延長整體流程時間
- **改進方案**：只在最後提示「請老媽接手」，明確指引下一步動作

---

## 📋 後續步驟

完成 Shortcut 執行後：

1. **確認檔案已下載**（在「下載項目」資料夾）
2. **開始使用 Safari 書籤**：
   - 點擊第一次：導航到申請表單頁面
   - 點擊第二次：自動填表
3. **上傳檔案**：依序上傳申請表 PDF 和藝人證圖片
4. **完成申請**

詳細的 Safari 書籤使用方式，請參考另一份文件。

---

## 📖 附錄：手動建立步驟

### 準備資訊
- 藝人證 Google Drive 下載網址（格式：`https://drive.google.com/uc?export=download&id=FILE_ID`）
- 申請網站首頁網址

### 建立步驟

#### 1. 建立新的 Shortcut
1. 開啟「捷徑」App
2. 點擊右上角「+」
3. 設定 Shortcut 名稱

#### 2. 新增動作（共 13 個）

**動作 1：取得捷徑輸入**
- 搜尋並加入「取得捷徑輸入」
- 類型：文字
- 若沒有輸入：繼續

**動作 2：URL 編碼**
- 搜尋並加入「URL 編碼」
- 模式：解碼
- 輸入：捷徑輸入

**動作 3：取得 URL 的內容**
- 搜尋並加入「取得 URL 的內容」
- URL：URL 編碼文字

**動作 4：文字**
- 搜尋並加入「文字」
- 點擊輸入框，選擇「當前日期」變數
- 在日期後方加上空格和文字「申請表」
- 最終格式：`[當前日期] 申請表`

**動作 5：將 URL 內容 儲存到**
- 搜尋並加入「將...儲存到」或「儲存檔案」
- 目的地：iCloud Drive → 下載項目
- 檔案名稱：使用動作 4 的文字
- 詢問儲存位置：關閉
- 覆寫已存在的檔案：開啟

**動作 6：文字**
- 搜尋並加入「文字」
- 輸入：藝人證 Google Drive 下載網址（完整 URL）

**動作 7：取得 URL 的內容**
- 搜尋並加入「取得 URL 的內容」
- URL：文字（動作 6 的輸出）

**動作 8：文字**
- 搜尋並加入「文字」
- 輸入：`藝人證`

**動作 9：將 URL 內容 儲存到**
- 搜尋並加入「將...儲存到」或「儲存檔案」
- 目的地：iCloud Drive → 下載項目
- 檔案名稱：藝人證（動作 8 的文字）
- 詢問儲存位置：關閉
- 覆寫已存在的檔案：開啟

**動作 10：開啟 URL**
- 搜尋並加入「開啟 URL」
- URL：申請網站首頁網址

**動作 11：等待**
- 搜尋並加入「等待」
- 時間：10 秒

**動作 12：朗讀文字**
- 搜尋並加入「朗讀文字」
- 文字：`請老媽接手，打開書籤。`

**動作 13：停止並輸出**
- 搜尋並加入「停止捷徑」
- 輸出：朗讀文字（動作 12 的輸出）
- 若未提供輸出的位置：不執行任何動作

#### 3. 完成設定
1. 檢查所有 13 個動作順序正確
2. 點擊右上角「完成」
3. 執行測試

---

## 📝 維護與更新

### 何時需要更新 Shortcut？

1. **藝人證圖片更換**：
   - 更新動作 6 的 Google Drive 網址
   
2. **申請網站網址變更**：
   - 更新動作 10 的網站網址

3. **語音提示調整**：
   - 修改動作 12 的文字內容

4. **等待時間調整**：
   - 根據實際使用情況調整動作 11 的秒數

### 更新方式

1. 開啟「捷徑」App
2. 找到對應的 Shortcut
3. 點擊進入編輯模式
4. 修改對應的動作
5. 點擊「完成」
6. 測試執行

### 匯出更新後的 Shortcut

1. 在「捷徑」App 中
2. 長按對應的 Shortcut
3. 選擇「分享」
4. 選擇「拷貝 iCloud 連結」或「儲存到檔案」
5. 更新專案中的 `.shortcut` 檔案

---

**建立日期**：2025年11月28日  
**版本**：最終定案版  
**狀態**：已部署 ✅

