# reCAPTCHA åœ–ç‰‡é©—è­‰è™•ç†æ–¹æ¡ˆ

## ğŸ“‹ å•é¡Œæè¿°

### ç•¶å‰ç‹€æ³
- **éšæ®µ**ï¼šPhase 6 éšæ®µ 2Bï¼ˆæ¸¬è©¦æ¨¡å¼ï¼Œåœåœ¨æäº¤å‰ï¼‰
- **å•é¡Œ**ï¼šè¡¨æ¼”å ´åœ°ç¶²ç«™çš„ reCAPTCHA é©—è­‰æœƒè§¸ç™¼åœ–ç‰‡é¸æ“‡é©—è­‰
- **é—œéµç™¼ç¾**ï¼š**é€é Cloud Run åŸ·è¡Œæ™‚ï¼Œç›®å‰ 100% è§¸ç™¼åœ–ç‰‡é©—è­‰**
  - Cloud Run ç’°å¢ƒçš„è‡ªå‹•åŒ–ç‰¹å¾µè¢« reCAPTCHA è­˜åˆ¥
  - æ¯æ¬¡åŸ·è¡Œéƒ½æœƒè¦æ±‚é¸æ“‡åœ–ç‰‡
  - **ç•¶å‰ç„¡æ³•è™•ç†åœ–ç‰‡é¸æ“‡é©—è­‰**
  - æœ¬åœ°æ¸¬è©¦ç’°å¢ƒå¤šæ•¸ä¸è§¸ç™¼ï¼ˆåƒ…é–‹ç™¼éæ¸¡éšæ®µï¼Œéé‡é»ï¼‰

### å¯¦éš›è§¸ç™¼æ¡ˆä¾‹
**Cloud Run ç’°å¢ƒ**æ¸¬è©¦éç¨‹ä¸­é‡åˆ°çš„åœ–ç‰‡é©—è­‰é¡å‹ï¼š

#### æ¡ˆä¾‹ 1ï¼šé¸æ“‡è‡ªè¡Œè»Šï¼ˆbicyclesï¼‰
![åœ–ç‰‡é¸æ“‡é©—è­‰1](ç”³è«‹æˆªåœ–/åœ–ç‰‡é¸æ“‡é©—è­‰1.png)
- **è¦æ±‚**ï¼šé¸æ“‡æ‰€æœ‰åŒ…å«è‡ªè¡Œè»Šçš„åœ–ç‰‡
- **æ ¼å¼**ï¼š3Ã—3 ç¶²æ ¼åœ–ç‰‡
- **èªè¨€**ï¼šè‹±æ–‡ç•Œé¢

#### æ¡ˆä¾‹ 2ï¼šé¸æ“‡å…¬äº¤è»Šï¼ˆbusï¼‰
![åœ–ç‰‡é¸æ“‡é©—è­‰2](ç”³è«‹æˆªåœ–/åœ–ç‰‡é¸æ“‡é©—è­‰2.png)
- **è¦æ±‚**ï¼šé¸æ“‡æ‰€æœ‰åŒ…å«å…¬äº¤è»Šçš„åœ–ç‰‡
- **æ ¼å¼**ï¼š3Ã—3 ç¶²æ ¼åœ–ç‰‡
- **èªè¨€**ï¼šè‹±æ–‡ç•Œé¢

**è§€å¯Ÿ**ï¼š
- é©—è­‰ç‰©é«”é¡å‹å‹•æ…‹è®ŠåŒ–ï¼ˆè‡ªè¡Œè»Šã€å…¬äº¤è»Šç­‰äº¤é€šå·¥å…·ï¼‰
- æ¯æ¬¡è§¸ç™¼éƒ½æ˜¯ä¸åŒçš„æŒ‘æˆ°é¡Œç›®
- ä»‹é¢çµ±ä¸€ï¼ˆ3Ã—3 ç¶²æ ¼ + "VERIFY" æŒ‰éˆ•ï¼‰

### æŠ€è¡“èƒŒæ™¯
- **reCAPTCHA é¡å‹**ï¼šåŒ…å«å‹¾é¸æ¡†å’Œåœ–ç‰‡æŒ‘æˆ°
- **è§¸ç™¼æ¨¡å¼**ï¼š**Cloud Run ç’°å¢ƒ 100% è§¸ç™¼**
- **è§¸ç™¼åŸå› åˆ†æ**ï¼š
  - Cloud Run ç„¡é ­ç€è¦½å™¨ç‰¹å¾µæ˜é¡¯
  - GCP æ•¸æ“šä¸­å¿ƒ IP åœ°å€è¢«è­˜åˆ¥ç‚ºéä½å®… IP
  - è‡ªå‹•åŒ–å·¥å…·æŒ‡ç´‹ï¼ˆPlaywrightï¼‰è¢«æª¢æ¸¬
  - ç¼ºä¹çœŸå¯¦ç”¨æˆ¶è¡Œç‚ºæ¨¡å¼ï¼ˆæ»‘é¼ ç§»å‹•ã€ç€è¦½æ­·å²ç­‰ï¼‰
  - Google çš„é¢¨éšªè©•ä¼°ç®—æ³•åˆ¤å®šç‚ºé«˜é¢¨éšª

### ç•¶å‰å¯¦ä½œç‹€æ…‹
- âœ… å¯ä»¥é»æ“Š reCAPTCHA å‹¾é¸æ¡†
- âŒ **ç„¡æ³•è™•ç†åœ–ç‰‡é¸æ“‡é©—è­‰**ï¼ˆCloud Run 100% è§¸ç™¼ï¼‰
- âŒ **ç„¡æ³•åµæ¸¬æ˜¯å¦è§¸ç™¼äº†åœ–ç‰‡é©—è­‰**
- âŒ **ç¨‹å¼æœƒåœ¨åœ–ç‰‡é©—è­‰è™•å¡ä½**

### å½±éŸ¿ç¯„åœ
- **ä¸»æµç¨‹å®Œå…¨ä¸­æ–·**ï¼šCloud Run åŸ·è¡Œæ™‚ 100% ç„¡æ³•å®Œæˆæäº¤
- **ç”¨æˆ¶é«”é©—**ï¼šç³»çµ±ç„¡å›æ‡‰ï¼Œå¿…é ˆäººå·¥ä»‹å…¥
- **æ¸¬è©¦å„ªå‹¢**ï¼šç©©å®šè§¸ç™¼ï¼Œå®¹æ˜“é‡ç¾å’Œæ¸¬è©¦è§£æ±ºæ–¹æ¡ˆ

---

## ğŸ¯ è§£æ±ºæ–¹æ¡ˆæ±ºç­–ï¼ˆ2025å¹´10æœˆ25æ—¥ï¼‰

### âœ… å·²ç¢ºå®šæ–¹æ¡ˆï¼šOpenAI GPT-4.1 Vision API

**æ ¸å¿ƒæ±ºç­–**ï¼š
- **æŠ€è¡“é¸å‹**ï¼šä½¿ç”¨ OpenAI GPT-4.1 Vision API è­˜åˆ¥ reCAPTCHA åœ–ç‰‡
- **é–‹ç™¼åˆ†æ”¯**ï¼š`feature/recaptcha-vision-solver`
- **æ¶æ§‹æ¨¡å¼**ï¼šæ–°å¢ç¨ç«‹æ¨¡çµ„ `recaptcha_vision_solver.py`

---

## ğŸ“‹ å¯¦ä½œè¦æ ¼

### 1. API Key ç®¡ç†
- **å¾…æ±ºç­–**ï¼šä½¿ç”¨ç¨ç«‹ API Key æˆ–èˆ‡ GAS å…±ç”¨åŒä¸€æŠŠï¼Ÿ
  - é¸é … Aï¼šGoogle Secret Manager æ–°å¢ç¨ç«‹ `openai-api-key-vision`ï¼ˆå»ºè­°ï¼‰
  - é¸é … Bï¼šèˆ‡ GAS å…±ç”¨åŒä¸€å€‹ `openai-api-key`

### 2. GPT-4.1 æ¨¡å‹åƒæ•¸ï¼ˆå·²ç¢ºå®šï¼‰
```python
RECAPTCHA_VISION_CONFIG = {
    "model": "gpt-4.1",
    "max_tokens": 150,      # åœ–ç‰‡è­˜åˆ¥ä¸éœ€è¦å¤ªå¤š
    "temperature": 0.0,     # æœ€ä½å‰µé€ æ€§ï¼Œè¿½æ±‚æº–ç¢º
    "detail": "high"        # é«˜ç´°ç¯€æ¨¡å¼ï¼Œæº–ç¢ºè­˜åˆ¥åœ–ç‰‡
}
```

**æˆæœ¬åˆ†æ**ï¼š
- æ¯æ¬¡ reCAPTCHAï¼ˆ9å¼µåœ–ç‰‡ + æç¤ºæ–‡å­—è§£æï¼‰ï¼šç´„ $0.002-0.003 USDï¼ˆå°å¹£ 0.06-0.09 å…ƒï¼‰
- æ¯æœˆæˆæœ¬ï¼ˆ1 æ¬¡ç”³è«‹ï¼Œæœ€å¤šé‡è©¦ 2 æ¬¡ï¼‰ï¼šå°å¹£ 0.06-0.18 å…ƒï¼ˆå¹¾ä¹å¯å¿½ç•¥ï¼‰

### 3. æ¶æ§‹è¨­è¨ˆï¼ˆå·²ç¢ºå®šï¼‰
```
code/cloud-run/
â”œâ”€â”€ main.py                          (æ—¢æœ‰ï¼Œä¸æ”¹å‹•)
â”œâ”€â”€ config.py                        (æ—¢æœ‰ï¼Œæ–°å¢ Vision API è¨­å®š)
â”œâ”€â”€ website_automation_cloud.py      (æ—¢æœ‰ï¼Œå‘¼å« solver)
â”œâ”€â”€ website_automation_local.py      (æ—¢æœ‰ï¼Œä¸æ”¹å‹•)
â”œâ”€â”€ website_automation_test.py       (æ–°å¢ï¼šæœ¬åœ° headless æ¸¬è©¦)
â””â”€â”€ recaptcha_vision_solver.py       (æ–°å¢ï¼šVision API è™•ç†æ ¸å¿ƒ)
```

**æ¸¬è©¦æµç¨‹**ï¼š
- `website_automation_test.py` â†’ èª¿ç”¨ â†’ `recaptcha_vision_solver.py`
- **ä¸åŒ…å«**å®Œæ•´æµç¨‹æ¸¬è©¦ï¼ˆå®Œæ•´æµç¨‹åœ¨ `website_automation_cloud.py`ï¼‰

### 4. é‡è©¦ç­–ç•¥ï¼ˆå·²ç¢ºå®šï¼‰
- **é‡è©¦æ¬¡æ•¸**ï¼š2 æ¬¡
- **å¤±æ•—è™•ç†**ï¼šå ±éŒ¯ä¸¦è§¸ç™¼äººå·¥è™•ç†æµç¨‹
- **é‚è¼¯**ï¼š
  1. ç¬¬ 1 æ¬¡ï¼šVision API è­˜åˆ¥ + é»æ“Š
  2. ç¬¬ 2 æ¬¡ï¼šå¦‚æœå¤±æ•—ï¼Œé‡è©¦ä¸€æ¬¡
  3. å¤±æ•—å¾Œï¼šè¨˜éŒ„éŒ¯èª¤ï¼Œé€šçŸ¥ LINEï¼Œæä¾›æª”æ¡ˆé€£çµä¾›äººå·¥æäº¤

### 5. Prompt è¨­è¨ˆï¼ˆå·²ç¢ºå®šï¼‰

#### A. æç¤ºæ–‡å­—è§£æ Promptï¼ˆæå–ç›®æ¨™ç‰©ä»¶ï¼‰

**ç›®çš„**ï¼šå¾ "Select all images with bicycles" æå– "bicycles"

**æç¤ºæ–‡å­—å…ƒç´ æ¢æ¸¬é‚è¼¯**ï¼ˆå¤šé¸æ“‡å™¨å˜—è©¦ï¼‰ï¼š
```python
# æŒ‰å„ªå…ˆé †åºå˜—è©¦ä»¥ä¸‹é¸æ“‡å™¨ï¼Œç›´åˆ°æ‰¾åˆ°ç‚ºæ­¢
CHALLENGE_TEXT_SELECTORS = [
    '.rc-imageselect-desc-no-canonical',  # æœ€å¸¸è¦‹
    '.rc-imageselect-desc',               # å‚™é¸1
    '.rc-imageselect-instructions',       # å‚™é¸2
    '.rc-imageselect-desc-wrapper'        # å‚™é¸3
]
```

**GPT-4.1 Text è§£æ Prompt**ï¼š
```python
extract_prompt = f"""
Extract the target object name from this reCAPTCHA challenge instruction.

Instruction text: "{challenge_text}"

Common patterns:
- "Select all images with [object]"
- "Select all squares with [object]"
- "Click on all images containing [object]"

Extract only the object name (e.g., "bicycles", "traffic lights", "buses", "crosswalks").

If the object is plural, keep it plural.
If there are multiple words (e.g., "traffic lights"), keep them together.

Response format (JSON only):
{{
    "target_object": "extracted object name",
    "confidence": 0.0-1.0
}}

Example:
Input: "Select all images with bicycles"
Output: {{"target_object": "bicycles", "confidence": 1.0}}

Input: "Click verify once there are none left"
Output: {{"target_object": "unknown", "confidence": 0.0}}
"""
```

**æˆæœ¬**ï¼šç´„ 100 tokens input + 20 tokens output = $0.0002ï¼ˆå¯å¿½ç•¥ï¼‰

---

#### B. åœ–ç‰‡è­˜åˆ¥ Promptï¼ˆä¸»è¦ Vision APIï¼‰

**Grid Layout è¦–è¦ºåŒ–**ï¼ˆASCII Artï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚  3  â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  4  â”‚  5  â”‚  6  â”‚  (Numbered left to right, top to bottom)
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  7  â”‚  8  â”‚  9  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

**å®Œæ•´ Vision Prompt**ï¼š
```python
vision_prompt = f"""
You are a reCAPTCHA image verification expert.

Task: Analyze this 3x3 grid image (9 tiles total) and identify which tiles contain "{target_object}".

Grid Layout:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚  3  â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  4  â”‚  5  â”‚  6  â”‚  (Numbered left to right, top to bottom)
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  7  â”‚  8  â”‚  9  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

IMPORTANT - Two possible scenarios:

Scenario A: Multiple separate objects
- Each tile contains a complete or partial view of a different {target_object}
- Example: Multiple bicycles, each in different tiles

Scenario B: One large object spanning multiple tiles
- A single large {target_object} is split across multiple adjacent tiles
- Example: One large bicycle spread across tiles 1,2,4,5

Instructions:
1. Carefully examine ALL 9 tiles in the grid
2. Identify tiles containing ANY part of the target object
3. Include tiles with:
   âœ“ Complete objects
   âœ“ Partial views (even small parts count)
   âœ“ Parts of larger objects spanning multiple tiles
4. Exclude tiles with:
   âœ— Similar but different objects (e.g., motorcycles when looking for bicycles)
   âœ— Completely unrelated content

Pay special attention to:
- Objects that span multiple tiles (consider all tiles they occupy)
- Partial views at tile edges
- Small or unclear portions that are still part of the target object
- Each tile may contain part of an object or no object at all

Response format (JSON only):
{{
    "selected_cells": [list of tile numbers containing {target_object}],
    "confidence": 0.0-1.0 (how confident you are),
    "explanation": "Brief reasoning",
    "pattern": "separate_objects" or "spanning_object"
}}

Example 1 (Separate objects):
If tiles 1, 3, 5, 7 each contain a different bicycle:
{{"selected_cells": [1, 3, 5, 7], "confidence": 0.95, "explanation": "4 separate bicycles clearly visible", "pattern": "separate_objects"}}

Example 2 (Spanning object):
If one large bicycle spans tiles 1, 2, 4, 5:
{{"selected_cells": [1, 2, 4, 5], "confidence": 0.92, "explanation": "One large bicycle spanning adjacent tiles", "pattern": "spanning_object"}}
"""
```

**Prompt å­˜æ”¾ä½ç½®**ï¼š
- ç›´æ¥æ”¾åœ¨ `recaptcha_vision_solver.py` ä¸­ä½œç‚ºé¡åˆ¥å¸¸æ•¸æˆ–æ–¹æ³•å…§å­—ä¸²
- ä¸ç¨ç«‹æˆæª”æ¡ˆï¼ˆé¿å…éåº¦è¨­è¨ˆï¼‰

**ä¿¡å¿ƒåº¦é–€æª»**ï¼š
- ä½æ–¼ 0.7ï¼ˆ70%ï¼‰å‰‡æ”¾æ£„ï¼Œè§¸ç™¼äººå·¥è™•ç†

### 6. éŒ¯èª¤è¨Šæ¯æ ¼å¼ï¼ˆå·²ç¢ºå®šï¼‰
```python
ERROR_MESSAGES = {
    "vision_api_failed": "[ç¶²ç«™æäº¤] reCAPTCHA åœ–ç‰‡è­˜åˆ¥å¤±æ•—: Vision API ç„¡æ³•è­˜åˆ¥é©—è­‰åœ–ç‰‡",
    "verification_timeout": "[ç¶²ç«™æäº¤] reCAPTCHA é©—è­‰è¶…æ™‚: é©—è­‰ç¢¼è™•ç†è¶…é 30 ç§’",
    "wrong_selection": "[ç¶²ç«™æäº¤] reCAPTCHA é©—è­‰å¤±æ•—: åœ–ç‰‡é¸æ“‡ä¸æ­£ç¢ºï¼Œå·²é‡è©¦ 2 æ¬¡ä½†ä»å¤±æ•—",
    "captcha_not_detected": "[ç¶²ç«™æäº¤] reCAPTCHA åµæ¸¬å¤±æ•—: ç„¡æ³•æ‰¾åˆ°é©—è­‰å…ƒç´ "
}
```

### 7. è¶…æ™‚å’Œé‡è©¦è¨­å®šï¼ˆå·²ç¢ºå®šï¼‰

```python
TIMEOUT_CONFIG = {
    "VISION_API_SINGLE_CALL": 15,   # Vision API å–®æ¬¡èª¿ç”¨ï¼ˆå«ç¶²è·¯å»¶é²ï¼‰
    "RECAPTCHA_VERIFICATION": 10,   # reCAPTCHA é©—è­‰ç­‰å¾…æ™‚é–“
    "TOTAL_PROCESS": 60,             # æ•´å€‹æµç¨‹ï¼ˆå«é‡è©¦2æ¬¡ï¼‰
    "CLICK_INTERVAL": 0.8,           # é»æ“Šæ ¼å­ä¹‹é–“çš„é–“éš”
    "RETRY_DELAY": 3                 # é‡è©¦å‰çš„ç­‰å¾…æ™‚é–“
}
```

**è¨ˆç®—é‚è¼¯**ï¼š
- å–®æ¬¡è™•ç†ï¼šæˆªåœ–(1ç§’) + Vision API(15ç§’) + é»æ“Š(7ç§’) + é©—è­‰(10ç§’) â‰ˆ 33ç§’
- å«é‡è©¦2æ¬¡ï¼šæœ€å¤š 60 ç§’

**é‡è©¦ç­–ç•¥**ï¼š
- é‡è©¦æ™‚é‡æ–°æˆªåœ–ï¼šâœ… æ˜¯ï¼ˆåœ–ç‰‡å¯èƒ½æ”¹è®Šï¼‰
- é‡è©¦æ™‚é‡æ–°å‘¼å« Vision APIï¼šâœ… æ˜¯ï¼ˆæ–°åœ–ç‰‡éœ€é‡æ–°åˆ†æï¼‰
- é‡è©¦æ™‚é‡æ–°è§£ææç¤ºæ–‡å­—ï¼šâœ… æ˜¯ï¼ˆå¯èƒ½è®Šæ›´ï¼‰
- è¶…æ™‚è™•ç†ï¼šè¨˜éŒ„éŒ¯èª¤ï¼Œè§¸ç™¼äººå·¥è™•ç†

### 8. æ¸¬è©¦æª”æ¡ˆç¢ºèªï¼ˆå·²ç¢ºèªï¼‰
- âœ… æ¸¬è©¦ PDFï¼š`ç”³è«‹è¡¨_2025å¹´11æœˆ_1106_2358.pdf`ï¼ˆFILE_ID: ***REMOVED***ï¼‰
- âœ… è¡—é ­è—äººè­‰ï¼š`è¡—é ­è—äººè­‰.jpg`ï¼ˆFILE_ID: ***REMOVED***ï¼‰

### 9. æœ¬åœ°æ¸¬è©¦æˆªåœ–çµæ§‹ï¼ˆå·²ç¢ºå®šï¼‰

#### ç¬¬ 2 æ­¥æ¸¬è©¦è³‡æ–™å¤¾çµæ§‹
```
ç”³è«‹æˆªåœ–/
â”œâ”€â”€ åœ–ç‰‡é¸æ“‡é©—è­‰1.pngï¼ˆæ—¢æœ‰ï¼‰
â”œâ”€â”€ åœ–ç‰‡é¸æ“‡é©—è­‰2.pngï¼ˆæ—¢æœ‰ï¼‰
â””â”€â”€ recaptcha_test/ï¼ˆæ–°å¢ï¼Œæœ¬åœ°æ¸¬è©¦å°ˆç”¨ï¼‰
    â””â”€â”€ trigger_test_20251025_151022/ï¼ˆç¬¬ 2 æ­¥ï¼šè§¸ç™¼æ¸¬è©¦ï¼‰
        â”œâ”€â”€ 1_before_recaptcha.png
        â”œâ”€â”€ 2_after_click.png
        â”œâ”€â”€ 3_image_challenge.png      ï¼ˆæ¢ä»¶æ€§ï¼šæœ‰åœ–ç‰‡é©—è­‰æ‰æˆªï¼‰
        â”œâ”€â”€ 4_grid_close_up.png        ï¼ˆæ¢ä»¶æ€§ï¼šæœ‰åœ–ç‰‡é©—è­‰æ‰æˆªï¼‰
        â””â”€â”€ 5_final_state.png
```

**ç¬¬ 2 æ­¥æˆªåœ–æ™‚æ©Ÿé»**ï¼š
- T1: é»æ“Š reCAPTCHA å‰
- T2: é»æ“Šå¾Œæª¢æŸ¥ç‹€æ…‹
- T3: åœ–ç‰‡æŒ‘æˆ°ç•«é¢ï¼ˆæ¢ä»¶æ€§ï¼šåµæ¸¬åˆ°åœ–ç‰‡é©—è­‰ï¼‰
- T4: åœ–ç‰‡ç¶²æ ¼ç‰¹å¯«ï¼ˆæ¢ä»¶æ€§ï¼šåµæ¸¬åˆ°åœ–ç‰‡é©—è­‰ï¼‰
- T5: æœ€çµ‚è¡¨å–®ç‹€æ…‹

**è¼¸å‡ºæ–¹å¼**ï¼š
- ç¬¬ 2 æ­¥ï¼šåªç”¨ `print()` è¼¸å‡ºæ¸¬è©¦çµæœ
- ç¬¬ 3 æ­¥+ï¼šè¦–éœ€æ±‚æ±ºå®šæ˜¯å¦åŠ å…¥ `test_result.json`

### 10. éŒ¯èª¤è™•ç†ç­–ç•¥ï¼ˆå·²ç¢ºå®šï¼‰

**æ‰€æœ‰éŒ¯èª¤çµ±ä¸€è™•ç†**ï¼šè¨˜éŒ„éŒ¯èª¤ï¼Œè§¸ç™¼äººå·¥è™•ç†

**éŒ¯èª¤åˆ†é¡**ï¼š
```
1. Vision API èª¿ç”¨å¤±æ•—ï¼ˆAPI Keyã€ç¶²è·¯ã€é¡åº¦ï¼‰
2. Vision API å›æ‡‰æ ¼å¼éŒ¯èª¤ï¼ˆç„¡æ³•è§£æ JSONï¼‰
3. Vision API ä¿¡å¿ƒåº¦éä½ï¼ˆ< 0.7ï¼‰
4. é»æ“Šæ“ä½œå¤±æ•—ï¼ˆå…ƒç´ æ‰¾ä¸åˆ°ã€iframe åˆ‡æ›å¤±æ•—ï¼‰
5. reCAPTCHA é©—è­‰å¤±æ•—ï¼ˆé¸æ“‡ä¸æ­£ç¢ºï¼‰
6. è¶…æ™‚éŒ¯èª¤ï¼ˆå„éšæ®µè¶…æ™‚ï¼‰
```

**æœ¬åœ°æ¸¬è©¦**ï¼šprint() è¼¸å‡ºè©³ç´°éŒ¯èª¤è¨Šæ¯
**Cloud Run**ï¼šè¨˜éŒ„æ—¥èªŒ + å›èª¿ GAS + LINE é€šçŸ¥

---

### 11. API Key ç®¡ç†ï¼ˆå·²ç¢ºå®šï¼‰

**æ±ºå®š**ï¼šä½¿ç”¨ç¨ç«‹çš„ OpenAI API Key

**è¨­å®šæ–¹å¼**ï¼š
```
æœ¬åœ°æ¸¬è©¦ï¼š
- ç›´æ¥å¯«åœ¨ config.py ä¸­
- API Key: å·²å»ºç«‹ç¨ç«‹çš„ Vision å°ˆç”¨ Key
- config.py å·²åœ¨ .gitignore ä¸­ï¼Œå®‰å…¨

Cloud Run éƒ¨ç½²ï¼š
- ä½¿ç”¨ Google Secret Manager
- Secret åç¨±ï¼šopenai-api-key-vision
- é€é get_openai_vision_key() æ–¹æ³•å‹•æ…‹è¼‰å…¥
```

**å„ªå‹¢**ï¼š
- âœ… æ¬Šé™åˆ†é›¢ï¼ˆGAS æ–‡å­—è™•ç† vs Cloud Run åœ–ç‰‡è­˜åˆ¥ï¼‰
- âœ… æˆæœ¬è¿½è¹¤æ¸…æ¥šï¼ˆå¯åœ¨ OpenAI Dashboard åˆ†åˆ¥æŸ¥çœ‹ï¼‰
- âœ… å®‰å…¨æ€§æ›´é«˜ï¼ˆKey æ´©éœ²å½±éŸ¿ç¯„åœå°ï¼‰
- âœ… æœªä¾†æ“´å±•éˆæ´»ï¼ˆå¯åŠ å…¥æ›´å¤š Vision åŠŸèƒ½ï¼‰

---

### 12. æ¸¬è©¦æ¶æ§‹è¨­è¨ˆï¼ˆå·²ç¢ºå®šï¼‰

**æª”æ¡ˆæ¶æ§‹**ï¼šé¸é … B - å»ºç«‹ç¨ç«‹æ¸¬è©¦æª”æ¡ˆï¼Œé‡ç”¨æ—¢æœ‰é¡åˆ¥

```
code/cloud-run/
â”œâ”€â”€ website_automation_local.py      (æ—¢æœ‰ï¼Œä¸æ”¹å‹•)
â”œâ”€â”€ website_automation_test.py       (æ–°å»ºï¼šæ¸¬è©¦å°ˆç”¨è…³æœ¬)
â””â”€â”€ recaptcha_vision_solver.py       (æ–°å»ºï¼šreCAPTCHA åµæ¸¬é‚è¼¯)
```

**å¯¦ä½œç­–ç•¥**ï¼š
1. **é‡ç”¨ `WebsiteAutomation` é¡åˆ¥**
   - é¿å…é‡è¤‡ç¨‹å¼ç¢¼
   - é‡ç”¨å°èˆªã€å¡«å¯«ã€ä¸Šå‚³é‚è¼¯
   - åªæ”¹è®Š `headless=True` åƒæ•¸

2. **æ–°å¢æ¸¬è©¦å°ˆç”¨é‚è¼¯**
   - reCAPTCHA åµæ¸¬åŠŸèƒ½
   - æ¢ä»¶æ€§æˆªåœ–ï¼ˆæœ‰åœ–ç‰‡é©—è­‰æ‰æˆªï¼‰
   - æ¸¬è©¦çµæœ print è¼¸å‡º

3. **ç¬¬ 2 æ­¥å¯¦ä½œç¯„åœ**
   - `recaptcha_vision_solver.py`ï¼š`detect_image_challenge()`, `take_screenshot()`
   - `website_automation_test.py`ï¼šå®Œæ•´æ¸¬è©¦æµç¨‹
   - `config.py`ï¼šæ–°å¢ `RECAPTCHA_VISION` é…ç½®

---

## âœ… æ±ºç­–å®Œæˆç¸½çµ

æ‰€æœ‰æŠ€è¡“æ±ºç­–å·²å®Œæˆï¼Œå¯ä»¥é–‹å§‹å¯¦ä½œï¼š

| é …ç›® | æ±ºç­– | ç‹€æ…‹ |
|------|------|------|
| æŠ€è¡“æ–¹æ¡ˆ | OpenAI GPT-4.1 Vision API | âœ… |
| é–‹ç™¼åˆ†æ”¯ | feature/recaptcha-vision-solver | âœ… |
| API Key ç®¡ç† | ç¨ç«‹ Key (openai-api-key-vision) | âœ… |
| æ¨¡å‹åƒæ•¸ | max_tokens=150, temp=0.0, detail=high | âœ… |
| Prompt è¨­è¨ˆ | å®Œæ•´ (å«æ–‡å­—è§£æ + åœ–ç‰‡è­˜åˆ¥) | âœ… |
| æ¶æ§‹æ¨¡å¼ | ç¨ç«‹æ¨¡çµ„ (recaptcha_vision_solver.py) | âœ… |
| æ¸¬è©¦æ¶æ§‹ | é¸é … B (ç¨ç«‹æ¸¬è©¦æª”æ¡ˆ + é‡ç”¨æ—¢æœ‰é¡åˆ¥) | âœ… |
| é‡è©¦ç­–ç•¥ | é‡è©¦ 2 æ¬¡ï¼Œå¤±æ•—äººå·¥è™•ç† | âœ… |
| è¶…æ™‚è¨­å®š | ç¸½è¨ˆ 60 ç§’ï¼ŒVision API 15 ç§’ | âœ… |
| æˆªåœ–ç­–ç•¥ | 5 å€‹æ™‚æ©Ÿé»ï¼ˆ2 å€‹æ¢ä»¶æ€§ï¼‰ | âœ… |
| éŒ¯èª¤è™•ç† | çµ±ä¸€è¨˜éŒ„ï¼Œè§¸ç™¼äººå·¥è™•ç† | âœ… |
| æ¸¬è©¦è¼¸å‡º | ç¬¬ 2 æ­¥ç”¨ printï¼Œç¬¬ 3 æ­¥+ å†è©•ä¼° JSON | âœ… |
| æ¸¬è©¦æª”æ¡ˆ | PDF + è­‰ç…§æª”æ¡ˆå·²ç¢ºèª | âœ… |

---

## ğŸ“… é–‹ç™¼é †åºï¼ˆå»ºè­°ï¼‰

```
ç¬¬ 1 æ­¥ï¼šç’°å¢ƒæº–å‚™ï¼ˆ1 å°æ™‚ï¼‰
â”œâ”€ æ±ºå®š API Key ç­–ç•¥
â”œâ”€ åœ¨ Secret Manager æ–°å¢å°æ‡‰çš„ Key
â””â”€ config.py æ–°å¢ Vision API è¨­å®š

ç¬¬ 2 æ­¥ï¼šå»ºç«‹æœ¬åœ°æ¸¬è©¦ç’°å¢ƒï¼ˆ2 å°æ™‚ï¼‰
â”œâ”€ æ–°å¢ website_automation_test.py
â”œâ”€ æ–°å¢ recaptcha_vision_solver.pyï¼ˆåŸºç¤æ¶æ§‹ï¼‰
â””â”€ æ¸¬è©¦ headless æ¨¡å¼èƒ½å¦è§¸ç™¼åœ–ç‰‡é©—è­‰

ç¬¬ 3 æ­¥ï¼šé–‹ç™¼ Vision Solver æ ¸å¿ƒï¼ˆ4-6 å°æ™‚ï¼‰
â”œâ”€ å¯¦ä½œåœ–ç‰‡æˆªå–é‚è¼¯
â”œâ”€ å¯¦ä½œæç¤ºæ–‡å­—è§£æï¼ˆGPT-4.1ï¼‰
â”œâ”€ å¯¦ä½œ Vision API å‘¼å«
â”œâ”€ å¯¦ä½œé»æ“Šé‚è¼¯
â””â”€ å¯¦ä½œé‡è©¦æ©Ÿåˆ¶ï¼ˆ2æ¬¡ï¼‰

ç¬¬ 4 æ­¥ï¼šæœ¬åœ°æ¸¬è©¦å’Œèª¿æ•´ï¼ˆ2-4 å°æ™‚ï¼‰
â”œâ”€ ä½¿ç”¨ website_automation_test.py æ¸¬è©¦
â”œâ”€ èª¿æ•´ prompt å’Œåƒæ•¸
â”œâ”€ é©—è­‰æˆåŠŸç‡
â””â”€ éŒ¯èª¤è™•ç†æ¸¬è©¦

ç¬¬ 5 æ­¥ï¼šæ•´åˆåˆ° Cloud Runï¼ˆ2 å°æ™‚ï¼‰
â”œâ”€ ä¿®æ”¹ website_automation_cloud.pyï¼ˆå‘¼å« solverï¼‰
â”œâ”€ éƒ¨ç½²åˆ° Cloud Run
â””â”€ æ¸¬è©¦å®Œæ•´æµç¨‹

ç¬¬ 6 æ­¥ï¼šçœŸå¯¦æäº¤æ¸¬è©¦ï¼ˆ1 å°æ™‚ï¼‰
â””â”€ éšæ®µ 2Cï¼šçœŸå¯¦æäº¤
```

**é ä¼°ç¸½æ™‚é–“**ï¼š12-16 å°æ™‚

---

**æ¸¬è©¦ç’°å¢ƒå„ªå‹¢**ï¼š
- âœ… Cloud Run 100% ç©©å®šè§¸ç™¼ï¼Œæ–¹ä¾¿æ¸¬è©¦
- âœ… å¯ä»¥å¿«é€Ÿé©—è­‰è§£æ±ºæ–¹æ¡ˆæ˜¯å¦æœ‰æ•ˆ
- âœ… ä¸éœ€è¦ç­‰å¾…éš¨æ©Ÿè§¸ç™¼

---

## ğŸ”— ç›¸é—œè³‡æº

### å°ˆæ¡ˆæª”æ¡ˆ
- `code/cloud-run/website_automation_cloud.py` - ç•¶å‰ reCAPTCHA è™•ç†é‚è¼¯ï¼ˆç¬¬ 358-394 è¡Œï¼‰
- `code/cloud-run/main.py` - éŒ¯èª¤è™•ç†å’Œé™ç´šæ©Ÿåˆ¶
- `code/gas/Code.js` - LINE é€šçŸ¥é‚è¼¯
- `ç”³è«‹æˆªåœ–/åœ–ç‰‡é¸æ“‡é©—è­‰1.png` - è‡ªè¡Œè»Šé©—è­‰æ¡ˆä¾‹
- `ç”³è«‹æˆªåœ–/åœ–ç‰‡é¸æ“‡é©—è­‰2.png` - å…¬äº¤è»Šé©—è­‰æ¡ˆä¾‹

---

**å»ºç«‹æ™‚é–“**ï¼š2025å¹´10æœˆ25æ—¥  
**ç‹€æ…‹**ï¼šå•é¡Œåˆ†æéšæ®µï¼Œè§£æ±ºæ–¹æ¡ˆå¾…è¨è«–  
**è² è²¬éšæ®µ**ï¼šPhase 6 éšæ®µ 2C

